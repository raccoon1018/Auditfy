<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Auditfy</title>

<!-- 로고 전용 폰트: Montserrat (앱 기본은 시스템 폰트) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="style.css">
</head>
<body class="theme-dark" data-auth="guest">

<!-- 상단바 -->
<div class="topbar">
  <div class="brandWrap">
    <!-- 홈 아이콘 버튼 (프로젝트 저장소로 이동, 가드용: data-href) -->
    <button id="btnHome" class="iconBtn" title="홈(프로젝트 저장소)" data-href="/projects.html">
      <svg viewBox="0 0 24 24"><path d="M4 12l8-7 8 7v8H4z"/></svg>
    </button>
    <div class="brand">
      <a class="logoLink" href="/projects.html" title="프로젝트로 이동"><span class="logo">Auditfy</span></a>
      <div class="chip">alpha</div>
    </div>
  </div>

  <div class="centerTitle">
    <div id="projectName">Untitled</div>
    <button id="renameBtn" title="이름 바꾸기">✎</button>
  </div>

  <div class="rightBtns">
    <button id="settingsBtn" class="iconBtn" title="설정">
      <svg viewBox="0 0 24 24"><path d="M4 7h16M8 7v6M12 13h8M12 13v4M4 17h10"/></svg>
    </button>
    <button id="avatar" class="iconBtn" title="계정">
      <svg viewBox="0 0 24 24"><path d="M12 12V12M5 20h14M8 18c0-2.5 2-4 4-4s4 1.5 4 4M12 12a4 4 0 0 0 0-8 4 4 0 0 0 0 8"/></svg>
    </button>
  </div>
</div>

<!-- 리본 -->
<div class="ribbon">
  <div class="tabs">
    <div class="tab active" data-tab="file"><svg viewBox="0 0 24 24"><path d="M6 3h9l3 3v15H6zM13 6v3h5"/></svg>파일</div>
    <div class="tab" data-tab="home"><svg viewBox="0 0 24 24"><path d="M4 11L12 4l8 7v9H4z"/></svg>홈</div>
    <div class="tab" data-tab="edit"><svg viewBox="0 0 24 24"><path d="M4 20h6M5 19l9-9 3 3-9 9"/></svg>편집</div>
    <div class="tab" data-tab="level"><svg viewBox="0 0 24 24"><path d="M6 4v16M12 8v12M18 12v8"/></svg>레벨</div>
    <div class="tab" data-tab="effect"><svg viewBox="0 0 24 24"><path d="M4 16h4l2-8 4 12 2-8h4"/></svg>효과</div>
    <div class="tab" data-tab="tools"><svg viewBox="0 0 24 24"><path d="M4 4h8v8H4zM12 12h8v8h-8z"/></svg>도구</div>
  </div>

  <div class="panelRow">
    <!-- 파일 -->
    <div id="panel-file" class="panel active">
      <div class="miniGroup">
        <button id="newBtn"   class="miniBtn"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg><span class="t">새 프로젝트</span></button>
        <button id="openBtn"  class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 6h9l3 3h4v9H4z"/></svg><span class="t">열기</span></button>
        <button id="saveBtn"  class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 20V4h10l4 4v12zM9 12h6v8H9z"/></svg><span class="t">저장</span></button>
        <button id="exportBtn"class="miniBtn"><svg viewBox="0 0 24 24"><path d="M12 4v10M8 10l4 4 4-4M4 20h16"/></svg><span class="t">내보내기</span></button>
        <input id="openProjectInput" type="file" accept=".json,.auditfy.json,.zip" />
      </div>
      <div class="miniGroup"><span class="chip">총 길이 <span id="totalLen">0:00</span></span></div>
    </div>

    <!-- 홈 -->
    <div id="panel-home" class="panel">
      <div class="miniGroup">
        <button id="btnPlay" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M7 6v12l10-6z"/></svg><span class="t">재생/일시정지</span></button>
        <button id="stopBtn" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg><span class="t">정지</span></button>
        <button id="btnLoop" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 7h10v4h3l-3 3H5"/></svg><span class="t">루프</span></button>
      </div>
      <div class="miniGroup">
        <button id="zoomOut" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M8 12h8"/></svg><span class="t">줌-</span></button>
        <button id="zoomIn"  class="miniBtn"><svg viewBox="0 0 24 24"><path d="M12 8v8M8 12h8"/></svg><span class="t">줌+</span></button>
        <span id="chipZoom" class="chip">ZOOM 25%</span>
        <button id="btnSnap" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h16M12 4v16"/></svg><span class="t">스냅 <span id="snapState">켜짐</span></span></button>
      </div>
      <div class="miniGroup">
        <button id="addTrackBtn" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 6h14M5 12h14M5 18h14M12 4v16"/></svg><span class="t">트랙 +</span></button>
        <button id="delTrackBtn" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 6h14M5 12h14M5 18h14"/></svg><span class="t">트랙 −</span></button>
        <button id="btnMark" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M6 3h12v18l-6-4-6 4z"/></svg><span class="t">마커</span></button>
        <span class="chip">마커 <span id="markerCount">0</span></span>
      </div>
    </div>

    <!-- 편집 -->
    <div id="panel-edit" class="panel">
      <div class="miniGroup">
        <button id="btnCut"   class="miniBtn"><svg viewBox="0 0 24 24"><path d="M6 6l12 12M6 18L12 12 18 6"/></svg><span class="t">자르기</span></button>
        <button id="btnCopy"  class="miniBtn"><svg viewBox="0 0 24 24"><path d="M7 7h10v10H7zM5 5h10v10H5z"/></svg><span class="t">복사</span></button>
        <button id="btnPaste" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M8 6h8v4H8zM6 10h12v8H6z"/></svg><span class="t">붙여넣기</span></button>
        <button id="btnSplit" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M12 4v16M4 12h16"/></svg><span class="t">분할</span></button>
        <button id="btnXFade" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 18L19 6M5 6l14 12"/></svg><span class="t">크로스페이드</span></button>
        <button id="btnAlign" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h16M12 4v16"/></svg><span class="t">커서 정렬</span></button>
      </div>
    </div>

    <!-- 레벨 -->
    <div id="panel-level" class="panel">
      <div class="miniGroup">
        <button id="btnAutoLoud" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 12h4l4-8 4 16 2-8"/></svg><span class="t">자동 레벨링</span></button>
        <button id="btnPeakNorm" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 18h16M4 6h10"/></svg><span class="t">피크 노멀라이즈</span></button>
        <button id="btnGainMatch" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 12h14M9 8v8M15 6v12"/></svg><span class="t">게인 매치</span></button>
        <button id="btnGate" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h16M4 8h8M4 16h12"/></svg><span class="t">무음 트림</span></button>
        <button id="btnLevelAll" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 19h16M6 19V6l3 4 3-6 3 8 3-5v12"/></svg><span class="t">전체 자동 레벨</span></button>
        <button id="btnPeakAll" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 18h14M5 12l4-4 4 6 4-8"/></svg><span class="t">전체 피크 정규화</span></button>
      </div>
    </div>

    <!-- 효과 -->
    <div id="panel-effect" class="panel">
      <div class="miniGroup">
        <button id="btnComp" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h16M8 6v12M16 4v16"/></svg><span class="t">컴프</span></button>
        <button id="btnLimit" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h16M10 6v12M14 6v12"/></svg><span class="t">리미터</span></button>
        <button id="btnEQ" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M6 19V5M12 19V9M18 19V3"/></svg><span class="t">EQ</span></button>
        <button id="btnRev" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 16h0c4-8 12-8 16 0"/></svg><span class="t">리버브</span></button>
        <button id="btnDelay" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 12h6M10 12l3-3M10 12l3 3M13 12h7"/></svg><span class="t">딜레이</span></button>
        <button id="btnPan" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M12 5v14"/><path d="M5 12h14"/><path d="M7 10v4M17 10v4"/></svg><span class="t">팬</span></button>
        <button id="btnPhase" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M6 6l12 12M6 18l12-12"/></svg><span class="t">위상 반전</span></button>
        <button id="btnChorus" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 16c2-6 6-6 8 0 2-6 6-6 8 0"/></svg><span class="t">코러스</span></button>
        <button id="btnHPF" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 18h14"/><path d="M9 18V6"/><path d="M15 18V10"/></svg><span class="t">하이패스</span></button>
      </div>
    </div>

    <!-- 도구 -->
    <div id="panel-tools" class="panel">
      <div class="miniGroup">
        <button id="btnQuickEdit" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 4h8v8H4zM12 12h8v8h-8z"/></svg><span class="t">QuickEdit</span></button>
        <button id="btnCleanup"   class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 6h16M7 6l1 14h8l1-14"/></svg><span class="t">파일 정리</span></button>
        <button id="btnAudit"     class="miniBtn"><svg viewBox="0 0 24 24"><path d="M4 4h16v12H4zM8 20h8"/></svg><span class="t">오디오 검사</span></button>
        <button id="btnShortcuts" class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 7h14M5 12h10M5 17h7"/></svg><span class="t">단축키</span></button>
        <button id="btnLog"       class="miniBtn"><svg viewBox="0 0 24 24"><path d="M5 4h14v16H5zM5 8h14"/></svg><span class="t">로그</span></button>
      </div>
    </div>
  </div>
</div>

<!-- 메인 -->
<div class="main">
  <div class="ruler" id="ruler"><div id="rulerInner"></div></div>

  <div class="workspace">
    <!-- 왼쪽 툴바 -->
    <div class="leftbar">
      <button class="ltBtn on" data-tool="select" title="선택"><svg viewBox="0 0 24 24"><path d="M4 4l8 8-3 3 8 8"/></svg></button>
      <button class="ltBtn" data-tool="cut" title="자르기"><svg viewBox="0 0 24 24"><path d="M6 6l12 12M6 18l6-6 6-6"/></svg></button>
      <button class="ltBtn" data-tool="marker" title="마커"><svg viewBox="0 0 24 24"><path d="M6 3h12v18l-6-4-6 4z"/></svg></button>
      <button class="ltBtn" data-tool="erase" title="삭제"><svg viewBox="0 0 24 24"><path d="M4 12L12 4l8 8-8 8H8z"/></svg></button>
      <button class="ltBtn" data-tool="move" title="이동"><svg viewBox="0 0 24 24"><path d="M12 2v20M2 12h20M8 6l4-4 4 4M8 18l4 4 4-4M6 8l-4 4 4 4M18 8l4 4-4 4"/></svg></button>
    </div>

    <div id="tracksCol" class="tracksCol"></div>

    <div id="laneWrap" class="laneWrap">
      <div id="timeline" class="timeline">
        <div id="clips" class="clips">
          <div id="markers"></div>
          <div id="playhead"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="dock">
    <div class="filehub">
      <div class="fh-head">
        <div style="display:flex;align-items:center;gap:8px">
          <strong>FileHub</strong>
          <span class="chip">드래그 & 드롭 가능</span>
        </div>
        <div style="display:flex;gap:8px">
          <input id="addFilesInput" type="file" accept="audio/*" multiple />
          <button id="btnSourcePicker" class="btn">불러오기</button>
        </div>
      </div>
      <div id="fhList" class="fh-list"></div>
      <div id="dropZone" class="drop">〈 여기에 파일을 드래그 & 드롭 〉</div>
    </div>

    <div class="xray">
      <div class="x-head"><strong>X-ray</strong><span id="xrayMeta" class="chip">선택한 클립의 파형 미리보기</span></div>
      <div class="x-body"><canvas id="xrayWave" width="300" height="64"></canvas></div>
    </div>
  </div>
</div>

<!-- 하단 상태바 -->
<div class="bottombar">
  <div class="status">
    <span>커서 <span id="cursorTime">0:00</span></span>
    <span>재생시간 <span id="statusTC">0:00</span></span>
    <span>길이 <span id="statusLen">0:00</span></span>
    <div class="vu"><div id="vuL"></div><div id="vuR"></div></div>
  </div>
  <!-- 경로/상태 표시는 여기 '준비됨'에 반영 (Cloud 탐색 중이면 경로로 갱신) -->
  <div class="status"><span id="statusPath">준비됨</span> <span class="chip">v1.5.3</span></div>
</div>

<!-- 설정 도크 -->
<div id="settingsDock" class="dockPanel">
  <div class="row"><div class="title">설정</div></div>
  <div class="row" style="display:flex;align-items:center;gap:8px;justify-content:space-between">
    <div>테마</div>
    <div class="ui-select" id="themeSelect" data-val="dark">
      <button type="button"><span class="sel-label">다크</span></button>
      <div class="menu"><div class="opt" data-val="dark">다크</div><div class="opt" data-val="light">라이트</div></div>
    </div>
    <div id="themeFollow" class="ui-toggle">시스템 설정 반영</div>
  </div>
  <div class="row"><div id="fxResetBtn" class="btn">효과 설정 초기화</div></div>
</div>

<!-- 계정 도크 (내용은 app.js가 로그인 상태에 따라 채움) -->
<div id="accountDock" class="dockPanel"></div>

<!-- QuickEdit 모달 -->
<div id="sourceModal" class="modal"><div class="card" style="min-width:340px;max-width:420px">
  <div class="hd">파일 불러오기</div>
  <div class="bd">
    <div class="modalList">
      <button type="button" id="sourceDevice" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M3 6h18M6 10h12M10 14h4M6 18h12"/></svg>
        <div class="opt-meta"><strong>기기에서 불러오기</strong><span>컴퓨터에 저장된 오디오 파일을 선택합니다.</span></div>
      </button>
      <button type="button" id="sourceCloud" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M6 15a4 4 0 0 1 4-4h1a5 5 0 0 1 9 2 3 3 0 0 1-1 6H7a3 3 0 0 1-1-6"/></svg>
        <div class="opt-meta"><strong>Auditfy Cloud에서 불러오기</strong><span>Cloud에 업로드해 둔 오디오를 가져옵니다.</span></div>
      </button>
      <button type="button" id="sourceYoutube" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M4 7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7z"/><path d="M10 9.5v5l4-2.5-4-2.5z"/></svg>
        <div class="opt-meta"><strong>YouTube에서 불러오기</strong><span>공개 영상의 오디오를 다운로드하여 추가합니다.</span></div>
      </button>
      <button type="button" id="sourceRecord" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M12 3a3 3 0 0 1 3 3v6a3 3 0 0 1-6 0V6a3 3 0 0 1 3-3z"/><path d="M5 10v2a7 7 0 0 0 14 0v-2"/><path d="M12 19v2M8 21h8"/></svg>
        <div class="opt-meta"><strong>음원 녹음하기</strong><span>마이크 입력을 바로 녹음해 타임라인에 추가합니다.</span></div>
      </button>
    </div>
  </div>
  <div class="ft"><button type="button" id="sourceClose" class="btn">닫기</button></div>
</div></div>

<div id="loginRequiredModal" class="modal"><div class="card" style="min-width:320px;max-width:380px">
  <div class="hd">로그인이 필요합니다</div>
  <div class="bd">
    Auditfy Cloud 기능을 사용하려면 로그인해야 합니다. 로그인하면 프로젝트 저장소, Cloud 파일 동기화 등의 기능을 이용할 수 있습니다.
  </div>
  <div class="ft">
    <button type="button" id="loginPromptClose" class="btn">닫기</button>
    <a id="loginPromptGo" class="btn grad" href="/auth.html?next=/index.html">로그인하기</a>
  </div>
</div></div>

<div id="youtubeModal" class="modal"><div class="card" style="min-width:360px;max-width:420px">
  <div class="hd">YouTube에서 불러오기</div>
  <div class="bd" style="display:flex;flex-direction:column;gap:12px">
    <div>
      <label style="display:flex;flex-direction:column;gap:6px">
        <span style="font-weight:600">영상 URL</span>
        <input id="youtubeInput" class="in" placeholder="https://www.youtube.com/watch?v=..." />
      </label>
    </div>
    <div class="recordHint">다운로드는 개인 학습/연습 용도로만 사용하세요. 일부 영상은 저작권 또는 지역 제한으로 인해 가져오지 못할 수 있습니다.</div>
  </div>
  <div class="ft"><button type="button" id="youtubeCancel" class="btn">취소</button><button type="button" id="youtubeImport" class="btn grad">불러오기</button></div>
</div></div>

<div id="recordModal" class="modal"><div class="card" style="min-width:360px;max-width:420px">
  <div class="hd">음원 녹음하기</div>
  <div class="bd" style="display:flex;flex-direction:column;gap:12px">
    <div class="recordStatus off" id="recordStatus"><div class="dot"></div><span>대기 중</span></div>
    <div id="recordTimer">00:00</div>
    <div class="recordHint">마이크 접근 권한을 허용하면 녹음을 시작할 수 있습니다.</div>
    <audio id="recordPreview" controls style="display:none;width:100%"></audio>
  </div>
  <div class="ft">
    <button type="button" id="recordClose" class="btn">닫기</button>
    <button type="button" id="recordStart" class="btn grad">녹음 시작</button>
    <button type="button" id="recordStop" class="btn" disabled>정지</button>
  </div>
</div></div>

<div id="projectOpenModal" class="modal"><div class="card" style="min-width:340px;max-width:420px">
  <div class="hd">프로젝트 불러오기</div>
  <div class="bd">
    <div class="modalList">
      <button type="button" id="openFromDevice" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M4 6h9l3 3h4v9H4z"/><path d="M9 13h6"/></svg>
        <div class="opt-meta"><strong>기기에서 불러오기</strong><span>.json 또는 .zip 프로젝트 파일을 선택합니다.</span></div>
      </button>
      <button type="button" id="openFromCloud" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M6 15a4 4 0 0 1 4-4h1a5 5 0 0 1 9 2 3 3 0 0 1-1 6H7a3 3 0 0 1-1-6"/><path d="M12 11v6"/><path d="M9 14l3 3 3-3"/></svg>
        <div class="opt-meta"><strong>프로젝트 저장소에서 불러오기</strong><span>Auditfy Cloud 프로젝트 저장소에 저장된 파일을 열어봅니다.</span></div>
      </button>
    </div>
  </div>
  <div class="ft"><button type="button" id="openModalClose" class="btn">닫기</button></div>
</div></div>

<div id="projectSaveModal" class="modal"><div class="card" style="min-width:340px;max-width:420px">
  <div class="hd">프로젝트 저장</div>
  <div class="bd">
    <div class="modalList">
      <button type="button" id="saveJsonLocal" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M5 20V4h10l4 4v12z"/><path d="M9 13h6M9 17h6"/></svg>
        <div class="opt-meta"><strong>기기에 저장하기 (JSON)</strong><span>프로젝트 구조만 저장됩니다. 오디오는 포함되지 않습니다.</span></div>
      </button>
      <button type="button" id="saveZipLocal" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M7 3h10l4 5v13H7a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z"/><path d="M12 3v5"/><path d="M12 12v4"/><path d="M12 20v1"/></svg>
        <div class="opt-meta"><strong>기기에 저장하기 (.zip)</strong><span>오디오 파일까지 모두 포함한 백업 파일을 생성합니다.</span></div>
      </button>
      <button type="button" id="saveToRepo" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M12 11v8"/><path d="M9 14l3 3 3-3"/><path d="M6 15a4 4 0 0 1 4-4h1a5 5 0 0 1 9 2 3 3 0 0 1-1 6H7a3 3 0 0 1-1-6"/></svg>
        <div class="opt-meta"><strong>프로젝트 저장소에 저장하기</strong><span>Cloud 프로젝트 저장소로 내보내어 공유하거나 백업합니다.</span></div>
      </button>
    </div>
  </div>
  <div class="ft"><button type="button" id="saveModalClose" class="btn">닫기</button></div>
</div></div>

<div id="quickEditModal" class="modal"><div class="card">
  <div class="hd">QuickEdit</div>
  <div class="bd" style="display:grid;grid-template-columns:1fr 300px;gap:12px">
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>순서 (드래그·클릭 선택)</strong>
        <div style="display:flex;gap:8px;align-items:center">
          <span id="qeCount" class="chip">선택 0</span>
          <button id="qeSelectAll" class="btn">전체 선택/해제</button>
        </div>
      </div>
      <div id="qeList" class="fh-list" style="height:260px;border:1px dashed var(--line);border-radius:10px;background:var(--bg)"></div>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px">
      <div>전환 길이(초)
        <div id="qeXfade" class="ui-slider" data-min="0" data-max="10" data-step="0.5" data-val="3" style="margin-top:8px">
          <div class="track" style="position:relative;height:10px;border:1px solid var(--line);border-radius:6px;background:rgba(255,255,255,.06)">
            <div class="bar" style="position:absolute;inset:0;width:30%;background:linear-gradient(90deg,var(--gradA),var(--gradB));border-radius:6px"></div>
            <div class="knob" style="position:absolute;top:-6px;width:22px;height:22px;border-radius:999px;border:1px solid var(--line);background:var(--bg-elev)"></div>
          </div>
          <div style="margin-top:6px"><span class="val">3</span> s</div>
        </div>
      </div>
      <div class="ui-toggle" id="qeAutoLevel">자동 오디오 레벨링</div>
      <div>레벨 타깃 (RMS)
        <div id="qeLevelTarget" class="ui-stepper" data-step="0.05" data-min="0.05" data-max="0.6" style="margin-left:8px">
          <button data-d="-1">－</button><span class="val">0.20</span><button data-d="+1">＋</button>
        </div>
      </div>
      <div class="ui-toggle" id="qeClear">기존 타임라인 지우고 재구성</div>
    </div>
  </div>
  <div class="ft"><button id="qeCancel" class="btn" onclick="document.getElementById('quickEditModal').classList.remove('open')">취소</button><button id="qeApply" class="btn grad">적용</button></div>
</div></div>

<!-- Export 모달 -->
<div id="exportModal" class="modal"><div class="card" style="min-width:360px;max-width:440px">
  <div class="hd">내보내기</div>
  <div class="bd" style="display:flex;flex-direction:column;gap:14px">
    <div style="display:flex;flex-direction:column;gap:10px">
      <label class="ui-toggle" id="toggleDateName">날짜로 제목 지정</label>
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
        <div class="ui-toggle" id="toggleMp3320" aria-pressed="false">MP3 320 kbps 사용</div>
        <span id="mp3Quota" class="chip">남은 320kbps(월): -</span>
      </div>
    </div>

    <div class="modalList">
      <button type="button" id="btnExportWav" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M5 4h10l4 4v12H5z"/><path d="M9 13h6"/><path d="M9 17h6"/></svg>
        <div class="opt-meta"><strong>WAV 내보내기</strong><span>무압축 PCM 품질로 마스터 파일을 저장합니다.</span></div>
      </button>
      <button type="button" id="btnExportMp3" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M4 6h9l3 3v9H4z"/><path d="M13 9v3h3"/></svg>
        <div class="opt-meta"><strong>MP3 내보내기</strong><span>플랜에 맞는 비트레이트로 빠르게 공유해보세요.</span></div>
      </button>
      <button type="button" id="btnExportProject" class="optionBtn">
        <svg viewBox="0 0 24 24"><path d="M4 6h9l3 3v9H4z"/><path d="M10 12h4"/><path d="M10 16h4"/></svg>
        <div class="opt-meta"><strong>프로젝트(.zip)</strong><span>타임라인과 오디오 파일 전체를 백업합니다.</span></div>
      </button>
    </div>

    <div style="color:var(--fg-weak);font-size:12px">
      MP3는 lamejs 기반 (Safari/Chrome 지원). 플랜에 따라 기본/고음질(320kbps) 선택 및 월별 320kbps 한도가 적용됩니다.
    </div>
  </div>
  <div class="ft">
    <button id="exportClose" class="btn" onclick="document.getElementById('exportModal').classList.remove('open')">닫기</button>
  </div>
</div></div>

<!-- 레벨/피크/효과 모달 -->
<div id="levelModal" class="modal"><div class="card">
  <div class="hd">자동 오디오 레벨링</div>
  <div class="bd">
    <div class="ui-toggle on" id="autoLevelOn">사용</div>
    <div style="margin-top:10px">타깃 RMS
      <div id="lvTarget" class="ui-stepper" data-step="0.05" data-min="0.05" data-max="0.6" style="margin-left:8px">
        <button data-d="-1">－</button><span class="val">0.20</span><button data-d="+1">＋</button>
      </div>
      <div style="color:var(--fg-weak);font-size:12px;margin-top:6px">모든 클립의 평균 음량(RMS)을 같은 기준으로 맞춥니다.</div>
    </div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('levelModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="peakModal" class="modal"><div class="card">
  <div class="hd">피크 노멀라이즈</div>
  <div class="bd">
    <div class="ui-toggle on" id="peakNormOn">사용</div>
    <div style="margin-top:10px">피크 상한
      <div id="pkCeil" class="ui-stepper" data-step="0.01" data-min="0.50" data-max="0.99" style="margin-left:8px">
        <button data-d="-1">－</button><span class="val">0.95</span><button data-d="+1">＋</button>
      </div>
      <div style="color:var(--fg-weak);font-size:12px;margin-top:6px">최대 레벨이 이 값을 넘지 않도록 균일하게 스케일합니다.</div>
    </div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('peakModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="compModal" class="modal"><div class="card">
  <div class="hd">컴프레서</div>
  <div class="bd">
    <div>Threshold <div id="compThr" class="ui-stepper" data-step="0.05" data-min="0.1" data-max="0.9"><button data-d="-1">－</button><span class="val">0.50</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px">Ratio <div id="compRatio" class="ui-stepper" data-step="0.5" data-min="1" data-max="20"><button data-d="-1">－</button><span class="val">4.0</span><button data-d="+1">＋</button></div></div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('compModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="limitModal" class="modal"><div class="card">
  <div class="hd">리미터</div>
  <div class="bd">
    <div>Ceiling <div id="limitCeil" class="ui-stepper" data-step="0.01" data-min="0.7" data-max="1.0"><button data-d="-1">－</button><span class="val">0.98</span><button data-d="+1">＋</button></div></div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('limitModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="eqModal" class="modal"><div class="card">
  <div class="hd">EQ (Low/High Shelf)</div>
  <div class="bd">
    <div>Low Shelf Gain <div id="eqLow" class="ui-stepper" data-step="1" data-min="-12" data-max="12"><button data-d="-1">－</button><span class="val">0</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px">High Shelf Gain <div id="eqHigh" class="ui-stepper" data-step="1" data-min="-12" data-max="12"><button data-d="-1">－</button><span class="val">0</span><button data-d="+1">＋</button></div></div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('eqModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="revModal" class="modal"><div class="card">
  <div class="hd">리버브</div>
  <div class="bd">
    <div>Mix <div id="revMix" class="ui-stepper" data-step="0.05" data-min="0" data-max="1"><button data-d="-1">－</button><span class="val">0.20</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px">Time <div id="revTime" class="ui-stepper" data-step="0.1" data-min="0.2" data-max="3"><button data-d="-1">－</button><span class="val">1.2</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px;color:var(--fg-weak);font-size:12px">간단한 스테레오 IR를 즉석 생성합니다.</div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('revModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="delayModal" class="modal"><div class="card">
  <div class="hd">딜레이</div>
  <div class="bd">
    <div>Time (s) <div id="delayTime" class="ui-stepper" data-step="0.05" data-min="0.05" data-max="1"><button data-d="-1">－</button><span class="val">0.25</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px">Feedback <div id="delayFb" class="ui-stepper" data-step="0.05" data-min="0" data-max="0.9"><button data-d="-1">－</button><span class="val">0.25</span><button data-d="+1">＋</button></div></div>
    <div style="margin-top:8px">Mix <div id="delayMix" class="ui-stepper" data-step="0.05" data-min="0" data-max="1"><button data-d="-1">－</button><span class="val">0.2</span><button data-d="+1">＋</button></div></div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('delayModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="panModal" class="modal"><div class="card">
  <div class="hd">팬(좌/우 밸런스)</div>
  <div class="bd">
    <div style="display:flex;flex-direction:column;gap:8px">
      <div>선택한 클립의 팬 값을 조정합니다. -1은 왼쪽, +1은 오른쪽입니다.</div>
      <div id="panStepper" class="ui-stepper" data-step="0.1" data-min="-1" data-max="1" style="margin-left:8px">
        <button data-d="-1">－</button><span class="val">0.0</span><button data-d="+1">＋</button>
      </div>
    </div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('panModal').classList.remove('open')">닫기</button></div>
</div></div>

<div id="hpfModal" class="modal"><div class="card">
  <div class="hd">하이패스 필터</div>
  <div class="bd">
    <div style="display:flex;flex-direction:column;gap:8px">
      <div>저주파 노이즈를 제거하고 싶은 경우 컷오프 주파수를 설정하세요.</div>
      <div id="hpfStepper" class="ui-stepper" data-step="20" data-min="0" data-max="2000" style="margin-left:8px">
        <button data-d="-1">－</button><span class="val">120</span><button data-d="+1">＋</button>
      </div>
    </div>
  </div>
  <div class="ft"><button class="btn" onclick="document.getElementById('hpfModal').classList.remove('open')">닫기</button></div>
</div></div>

<!-- 정보/단축키/로그/확인/이름변경/로딩 -->
<div id="infoModal" class="modal"><div class="card"><div class="hd">정보</div><div class="bd" id="infoBody"></div><div class="ft"><button class="btn" onclick="document.getElementById('infoModal').classList.remove('open')">닫기</button></div></div></div>
<div id="shortcutsModal" class="modal"><div class="card"><div class="hd">단축키</div><div class="bd" id="scBody"></div><div class="ft"><button class="btn" onclick="document.getElementById('shortcutsModal').classList.remove('open')">닫기</button></div></div></div>
<div id="logModal" class="modal"><div class="card"><div class="hd">로그</div><div class="bd" id="logBody"></div><div class="ft"><button class="btn" onclick="document.getElementById('logModal').classList.remove('open')">닫기</button></div></div></div>
<div id="confirmModal" class="modal"><div class="card"><div class="hd">확인</div><div class="bd"><div id="confirmText">이 작업을 진행할까요?</div></div><div class="ft"><button id="confirmNo" class="btn">취소</button><button id="confirmYes" class="btn grad">확인</button></div></div></div>
<div id="renameModal" class="modal"><div class="card"><div class="hd">프로젝트 이름 변경</div><div class="bd"><input id="renameInput" class="in" placeholder="프로젝트 이름" /></div><div class="ft"><button id="renameCancel" class="btn" onclick="document.getElementById('renameModal').classList.remove('open')">취소</button><button id="renameOk" class="btn grad">저장</button></div></div></div>
<div id="loading"><div class="spinner" aria-label="loading"></div></div>

<!-- 우클릭 컨텍스트 메뉴 -->
<div id="clipMenu">
  <div class="mi" data-act="dup">복제</div>
  <div class="mi" data-act="split">분할(플레이헤드)</div>
  <div class="mi" data-act="del" style="color:var(--danger)">삭제</div>
</div>

<div id="snack"></div>

<!-- Cloud API + 에디터 스크립트 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script src="./cloud.js"></script>
<script type="module" src="./app.js"></script>

</body>
</html>
